# Docker Registry Helm Chart Values
# Configured for k3d master cluster with NodePort service
#
# Port Architecture:
#   External (host):     localhost:5100 (mapped via k3d loadbalancer)
#   Internal (k8s):      docker-registry.docker-registry.svc.cluster.local:5000
#   Container:           :5000 (required for health probes)
#   NodePort:            30500
#
# Note: Port 5000 is already used by k3d's built-in master-registry,
#       so we expose this registry externally on port 5100 instead.
#
# Access:
#   - From host:         localhost:5100
#   - From GitLab CI:    docker-registry.docker-registry.svc.cluster.local:5000
#   - Via Tailscale SSH: ssh -L 5100:localhost:5100 <user>@<hostname>

# Service configuration - NodePort
# Container listens on port 5000, exposed via NodePort 30500
service:
  type: NodePort
  nodePort: 30500
  port: 5000

# Persistence configuration
persistence:
  enabled: true
  size: 50Gi
  storageClass: local-path
  accessMode: ReadWriteOnce

# Storage configuration
storage: filesystem

# Resource limits (minimal for local dev)
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 256Mi

# Security configuration - insecure mode for local development
# For production, you would configure TLS and authentication here
configData:
  version: 0.1
  log:
    fields:
      service: registry
  storage:
    cache:
      blobdescriptor: inmemory
    filesystem:
      rootdirectory: /var/lib/registry
  http:
    addr: :5000
    headers:
      X-Content-Type-Options: [nosniff]
  health:
    storagedriver:
      enabled: true
      interval: 10s
      threshold: 3

# Enable garbage collection
garbageCollect:
  enabled: false
  deleteUntagged: true
  schedule: "0 1 * * *"

# Replica count
replicaCount: 1

# Update strategy
updateStrategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0
